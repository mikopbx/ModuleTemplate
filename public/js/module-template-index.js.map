{"version":3,"sources":["src/module-template-index.js"],"names":["ModuleTemplate","$formObj","$","$checkBoxes","$dropDowns","$disabilityFields","$statusToggle","$moduleStatus","validateRules","textField","identifier","rules","type","prompt","globalTranslate","mod_tplValidateValueIsEmpty","areaField","passwordField","initialize","checkbox","dropdown","checkStatusToggle","window","addEventListener","initializeForm","removeClass","show","addClass","hide","applyConfigurationChanges","changeStatus","api","url","Config","pbxUrl","on","successTest","response","Object","keys","length","result","toUpperCase","onSuccess","onFailure","cbBeforeSendForm","settings","data","form","cbAfterSendForm","Form","globalRootUrl","status","html","mod_tpl_Connected","mod_tpl_Disconnected","mod_tpl_UpdateStatus","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 11 2018\n *\n */\n\n/* global globalRootUrl, globalTranslate, Form, Config */\n\nconst ModuleTemplate = {\n\t$formObj: $('#module-template-form'),\n\t$checkBoxes: $('#module-template-form .ui.checkbox'),\n\t$dropDowns: $('#module-template-form .ui.dropdown'),\n\t$disabilityFields: $('#module-template-form  .disability'),\n\t$statusToggle: $('#module-status-toggle'),\n\t$moduleStatus: $('#status'),\n\t/**\n\t * Правила валидации полей\n\t * https://semantic-ui.com/behaviors/form.html\n\t */\n\tvalidateRules: {\n\t\ttextField: {\n\t\t\tidentifier: 'text_field',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.mod_tplValidateValueIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tareaField: {\n\t\t\tidentifier: 'text_area_field',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.mod_tplValidateValueIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tpasswordField: {\n\t\t\tidentifier: 'password_field',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.mod_tplValidateValueIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t},\n\t/**\n\t * Инициализация класса, при открытии страницы\n\t */\n\tinitialize() {\n\t\t// инициализируем чекбоксы и выподающие менюшки\n\t\tModuleTemplate.$checkBoxes.checkbox();\n\t\tModuleTemplate.$dropDowns.dropdown();\n\t\tModuleTemplate.checkStatusToggle();\n\t\twindow.addEventListener('ModuleStatusChanged', ModuleTemplate.checkStatusToggle);\n\t\tModuleTemplate.initializeForm();\n\t},\n\t/**\n\t * Изменение статуса кнопок при изменении статуса модуля\n\t */\n\tcheckStatusToggle() {\n\t\tif (ModuleTemplate.$statusToggle.checkbox('is checked')) {\n\t\t\tModuleTemplate.$disabilityFields.removeClass('disabled');\n\t\t\tModuleTemplate.$moduleStatus.show();\n\t\t} else {\n\t\t\tModuleTemplate.$disabilityFields.addClass('disabled');\n\t\t\tModuleTemplate.$moduleStatus.hide();\n\t\t}\n\t},\n\t/**\n\t * Применение настроек модуля после изменения данных формы\n\t */\n\tapplyConfigurationChanges() {\n\t\tModuleTemplate.changeStatus('Updating');\n\t\t$.api({\n\t\t\turl: `${Config.pbxUrl}/pbxcore/api/modules/ModuleTemplate/reload`,\n\t\t\ton: 'now',\n\t\t\tsuccessTest(response) {\n\t\t\t\t// test whether a JSON response is valid\n\t\t\t\treturn Object.keys(response).length > 0 && response.result.toUpperCase() === 'SUCCESS';\n\t\t\t},\n\t\t\tonSuccess() {\n\t\t\t\tModuleTemplate.changeStatus('Connected');\n\t\t\t},\n\t\t\tonFailure() {\n\t\t\t\tModuleTemplate.changeStatus('Disconnected');\n\t\t\t},\n\t\t});\n\t},\n\t/**\n\t * Действие перед отправкой формы на сервер\n\t * @param settings\n\t * @returns {*}\n\t */\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = ModuleTemplate.$formObj.form('get values');\n\t\treturn result;\n\t},\n\t/**\n\t * Действие после сохранения настроек\n\t */\n\tcbAfterSendForm() {\n\t\tModuleTemplate.applyConfigurationChanges();\n\t},\n\t/**\n\t * Инициализация формы при открытии\n\t */\n\tinitializeForm() {\n\t\tForm.$formObj = ModuleTemplate.$formObj;\n\t\tForm.url = `${globalRootUrl}module-template/save`;\n\t\tForm.validateRules = ModuleTemplate.validateRules;\n\t\tForm.cbBeforeSendForm = ModuleTemplate.cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = ModuleTemplate.cbAfterSendForm;\n\t\tForm.initialize();\n\t},\n\t/**\n\t * Обновление статуса модуля\n\t * @param status\n\t */\n\tchangeStatus(status) {\n\t\tswitch (status) {\n\t\t\tcase 'Connected':\n\t\t\t\tModuleTemplate.$moduleStatus\n\t\t\t\t\t.removeClass('grey')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('green');\n\t\t\t\tModuleTemplate.$moduleStatus.html(globalTranslate.mod_tpl_Connected);\n\t\t\t\tbreak;\n\t\t\tcase 'Disconnected':\n\t\t\t\tModuleTemplate.$moduleStatus\n\t\t\t\t\t.removeClass('green')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('grey');\n\t\t\t\tModuleTemplate.$moduleStatus.html(globalTranslate.mod_tpl_Disconnected);\n\t\t\t\tbreak;\n\t\t\tcase 'Updating':\n\t\t\t\tModuleTemplate.$moduleStatus\n\t\t\t\t\t.removeClass('green')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('grey');\n\t\t\t\tModuleTemplate.$moduleStatus.html(`<i class=\"spinner loading icon\"></i>${globalTranslate.mod_tpl_UpdateStatus}`);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tModuleTemplate.$moduleStatus\n\t\t\t\t\t.removeClass('green')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('grey');\n\t\t\t\tModuleTemplate.$moduleStatus.html(globalTranslate.mod_tpl_Disconnected);\n\t\t\t\tbreak;\n\t\t}\n\t},\n};\n\n$(document).ready(() => {\n\tModuleTemplate.initialize();\n});\n\n"],"file":"module-template-index.js"}